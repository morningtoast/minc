{"ts":1349889600671,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?php\r\n/*\r\n    MINC Mini Content Management\r\n\t2012, Brian Vaughn - @morningtoast\r\n*/\t\r\n\tclass minc {\r\n\t\r\n\t\t// Constructor, optional pass override settings\r\n\t\tfunction minc($a_settings=array()) {\r\n\t\t\t$a_default = array(\r\n\t\t\t\t\"path\"      => \"./content/\",\r\n\t\t\t\t\"extension\" => \".inc\",\r\n\t\t\t\t\"enablerun\" => false\r\n\t\t\t);\r\n\t\t\t\r\n\t\t\t$this->settings = array_merge($a_default, $a_settings);\r\n\t\t}\r\n\t\t\r\n\t\t// Echos raw file requested\r\n\t\tfunction fetch() {\r\n\t\t\tif (isset($_GET[\"fetch\"])) {\r\n\t\t\t\techo $this->get($_GET[\"fetch\"], false);\r\n\t\t\t} else {\r\n\t\t\t\treturn(false);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Echos trimmed content file; This is used in content pages\r\n\t\tfunction load($id) {\r\n\t\t\techo $this->get($id);\r\n\t\t}\r\n\t\t\r\n\t\t// Reads content file with optional trim\r\n\t\tfunction get($id, $trim=true) {\r\n\t\t\t$output = \"\";\r\n\t\t\t$path   = $this->getPath($id);\r\n\t\t\t\r\n\t\t\tif (file_exists($path)) {\r\n\t\t\t\t$lines   = file($path);\r\n\t\t\t\tif ($trim) { $summary = array_shift($lines); }\r\n\t\t\t\t\t\t\r\n\t\t\t\t$output = implode(\"\",$lines);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn($output);\r\n\t\t}\r\n\t\t\r\n\t\t// Evals content block; Must enable eval in settings\r\n\t\tfunction run($id) {\r\n\t\t\tif ($this->enablerun) {\r\n\t\t\t\t$code = $this->get($id);\r\n\t\t\t\teval($code);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Builds server path to content file\r\n\t\tfunction getPath($id) {\r\n\t\t\t$path = $this->settings[\"path\"].$id.$this->settings[\"extension\"];\r\n\t\t\treturn($path);\r\n\t\t}\r\n\t\t\r\n\t\t// Reads content directory for listing\r\n\t\tfunction dir() {\r\n\t\t\t$a_list = array();\r\n\t\t\tif ($handle = opendir($this->settings[\"path\"])) {\r\n\t\t\t\twhile (false !== ($entry = readdir($handle))) {\r\n\t\t\t\t\tif ($entry != \".\" && $entry != \"..\") {\r\n\t\t\t\t\t\t$lines   = file($this->settings[\"path\"].$entry);\r\n\t\t\t\t\t\t$summary = array_shift($lines);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t$a_list[] = array(\r\n\t\t\t\t\t\t\t\"file\"    => $entry,\r\n\t\t\t\t\t\t\t\"id\"      => str_replace(\".inc\",\"\",$entry),\r\n\t\t\t\t\t\t\t\"summary\" => $summary\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tclosedir($handle);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t$this->list = $a_list;\r\n\t\t}\r\n\t\t\r\n\t\t// Saves changes to content file\r\n\t\tfunction save() {\r\n\t\t\tif (isset($_POST[\"save\"])) {\r\n\t\t\t\t$summary = $_POST[\"contentsummary\"];\r\n\t\t\t\t$code    = $_POST[\"content\"];\r\n\t\t\t\t$id      = str_replace(\" \",\"-\",strtolower(trim(strip_tags($_POST[\"contentid\"]))));\r\n\t\t\t\t$path    = $this->getPath($id);\r\n\t\t\t\t\r\n\t\t\t\t$content = $summary.\"\\r\\n\".$code;\r\n\t\t\t\r\n\t\t\t\t$fr = fopen($path,\"w+\");\r\n\t\t\t\tfwrite($fr,$content);\r\n\t\t\t\tfclose($fr);\r\n\t\t\t\t\r\n\t\t\t\treturn($path);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Deletes content file\r\n\t\tfunction delete() {\r\n\t\t\t$success = false;\r\n\t\t\t\r\n\t\t\tif (isset($_GET[\"k\"])) {\r\n\t\t\t\t$success = unlink($this->getPath($_GET[\"k\"]));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn($success);\r\n\t\t}\r\n\t}\r\n?>"]],"start1":0,"start2":0,"length1":0,"length2":2592}]],"length":2592}
